# Use the official oauth2-proxy image as base
FROM quay.io/oauth2-proxy/oauth2-proxy:v7.9.0

ENV OAUTH2_PROXY_PROVIDER="gitlab"
ENV OAUTH2_PROXY_REDIRECT_URL="https://172.18.0.240.nip.io/oauth2/callback"
ENV OAUTH2_PROXY_HTTP_ADDRESS="0.0.0.0:4180"
ENV OAUTH2_PROXY_UPSTREAMS="http://nginx:8080"
ENV OAUTH2_PROXY_OIDC_ISSUER_URL="https://projects.govcms.gov.au"
ENV OAUTH2_PROXY_EMAIL_DOMAINS="*"
ENV OAUTH2_PROXY_COOKIE_SECURE="false"
ENV OAUTH2_PROXY_SCOPE="openid profile email"
ENV OAUTH2_PROXY_CODE_CHALLENGE_METHOD="S256"
ENV OAUTH2_PROXY_COOKIE_CSRF_PER_REQUEST="true"
ENV OAUTH2_PROXY_SKIP_PROVIDER_BUTTON="true"
ENV OAUTH2_PROXY_REVERSE_PROXY="true"

